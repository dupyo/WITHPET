<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- JAVA와 연결할 Mapper 파일 설정 -->
<mapper namespace="poly.persistance.mapper.ReviewMapper">
	<!-- 게시물 작성 -->
	<insert id="insertReviewProc" parameterType="ReviewDTO">
		
		INSERT INTO BOARD_REVIEW
			(
				USER_NO,
				BOARD_NO,
				REVIEW_CONTENT,
				REG_DATE,
				REG_NO
				
			)
			VALUES
			(
				#{userNo},
				#{boardNo},
				#{content},
				NOW(),
				#{userNo}
			)
			
	</insert>
	
	<!-- 관리자 - 리뷰 리스트 불러오기 -->
	<select id="getReviewList" parameterType="string" resultType="ReviewDTO">
		
		SELECT 
			R.REVIEW_NO as reviewNo,
			R.USER_NO as userNo,
			U.USER_NAME as userName,
			R.BOARD_NO as boardNo,
			R.REVIEW_CONTENT as content,
			R.REG_DATE as regDate,
			R.UPD_DATE as updDate
		FROM BOARD_REVIEW R
		INNER JOIN USER_INFO U
		ON R.USER_NO=U.USER_NO
		WHERE R.BOARD_NO=#{boardNo}
		
	</select>
	
	<!-- 리뷰 작성 후 바로 리스트 불러오기 ajax -->
	<select id="insertNgetListAjax" parameterType="ReviewDTO" resultType="ReviewDTO">
		
		SELECT 
			R.REVIEW_NO as reviewNo,
			R.USER_NO as userNo,
			U.USER_NAME as userName,
			R.BOARD_NO as boardNo,
			R.REVIEW_CONTENT as content,
			R.REG_DATE as regDate,
			R.UPD_DATE as updDate
		FROM BOARD_REVIEW R
		INNER JOIN USER_INFO U
		ON R.USER_NO=U.USER_NO
		WHERE R.BOARD_NO=#{boardNo}
		
	</select>
	
	<!-- 리뷰 상세 불러오기 -->
	<!-- <select id="getReviewDetail" parameterType="string" resultType="ReviewDTO">
		
		SELECT 
			B.BOARD_NO as boardNo,
			B.USER_NO as userNo,
			U.USER_NAME as userName,
			B.BOARD_TITLE as title,
			B.BOARD_CONTENT as content,
			B.BOARD_COUNT as count,
			B.REG_DATE as regDate,
			B.UPD_DATE as updDate,
			B.BOARD_LEVEL as boardLevel
		FROM BOARD_REVIEW B
		INNER JOIN USER_INFO U
		ON B.USER_NO=U.USER_NO
		WHERE B.BOARD_NO=#{boardNo}
		
	</select> -->
	
	<!-- 리뷰 수정 (만든거 후회하고 있음)-->
	<update id="updateReviewProc" parameterType="ReviewDTO">
	
		UPDATE BOARD_REVIEW
		SET REVIEW_CONTENT=#{content},
		UPD_DATE=NOW(),
		UPD_NO=#{userNo}
		WHERE REVIEW_NO=#{reviewNo}
	
	</update>
	
	<!-- 리뷰 삭제 -->
	<delete id="deleteReviewProc" parameterType="string">
	
        DELETE
        FROM BOARD_REVIEW
		WHERE REVIEW_NO=#{reviewNo}
	
	</delete>
	

</mapper>